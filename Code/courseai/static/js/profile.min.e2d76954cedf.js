var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,b,d){a instanceof String&&(a=String(a));for(var c=a.length,e=0;e<c;e++){var f=a[e];if(b.call(d,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,d){a!=Array.prototype&&a!=Object.prototype&&(a[b]=d.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,b,d,c){if(b){d=$jscomp.global;a=a.split(".");for(c=0;c<a.length-1;c++){var e=a[c];e in d||(d[e]={});d=d[e]}a=a[a.length-1];c=d[a];b=b(c);b!=c&&null!=b&&$jscomp.defineProperty(d,a,{configurable:!0,writable:!0,value:b})}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,d){return $jscomp.findInternal(this,a,d).v}},"es6","es3");var PLAN_DELIMITER="|",CODE_DELIMITER="~",degreeDict={},majorDict={},minorDict={},specDict={};
function createDeleteBtn(a){var b=$('<button class="btn btn-outline-danger btn-sm btn-delete">Delete</button>');b.on("click",function(){$("#delete-modal").find(".modal-body").html("Are you sure you want to delete plan: "+a+"? </br>This action cannot be undone.");$("#delete-modal").modal("show");$("#delete-plan-btn").on("click",function(){$.ajax({url:"/accounts/degree_plan_view",method:"DELETE",data:{code:a},success:function(a){b.parent().parent().remove()}})})});return b}
function createLoadBtn(a,b,d){var c=$('<button class="btn btn-outline-success btn-sm btn-load mb-2">Load</button>');c.on("click",function(){0!==$(this).parent().prev().length&&(window.location="/planner?startyear="+b+"&semester="+d+"&saveCode="+a+"&degreeName=&degreeCode=&degreeName2=&degreeCode2=&")});return c}function stringifyDegreeCodes(a){for(var b="",d=0;d<a.length;d++)0!==d&&(b+=", </br>"),b+=degreeDict[a[d]];return b}
function stringifyMMS(a){var b="";if(0<a.length&&"string"===typeof a[0])return a.join(",</br>");for(var d=0;d<a.length;d++){var c=a[d].code,e=a[d].year,f=c.substr(c.length-3);0!==d&&(b+=", </br>");"MAJ"===f?b+=majorDict[c+e]:"MIN"===f?b+=minorDict[c+e]:(b+=specDict[c+e],f=c.substr(c.length-4));b+=" ("+f+")"}return b}$.ajax({url:"/degree/all",success:function(a){for(i in a.response)degreeDict[String(a.response[i].code)]=a.response[i].title}});
function mapMMSCodeToTitle(a,b){return $.ajax({url:"/search/"+a,dataType:"json",contentType:"application/json",success:function(a){for(var c=0;c<a.response.length;c++){var d=a.response[c]._source.code,f=a.response[c]._source.versions,g;for(g in f)b[String(d)+String(g)]=f[g].title}}})}function restrictInput(a){a.on("input",function(){var a=this.selectionStart,d=/[^a-z0-9'.,- ]/gi,c=$(this).val();d.test(c)&&($(this).val(c.replace(d,"")),a--);this.setSelectionRange(a,a)})}
function createSavedPlansTable(){$.ajax({url:"/accounts/degree_plan_view",success:function(a){if(1<a.length){a=a.split(PLAN_DELIMITER);for(var b=0;b<a.length;b++)a[b]=a[b].split(CODE_DELIMITER);var d=$("#saved-plans-table").find("tbody"),c={};for(b=0;b<a.length;c={code:c.code,editIcon:c.editIcon},b++){var e=JSON.parse(a[b][1]);c.code=a[b][0];var f=$('<tr class="d-flex">'),g=$('<td class="col-1 btn-container text-center"/>'),h=$('<textarea class="plan-name-input form-control" pattern="[A-Za-z0-9\'.,-]" placeholder="edit name"/>');
"name"in e&&0!==e.name.length?h.val(e.name):h.addClass("hidden");restrictInput(h);h.on("change",function(a){return function(){$.ajax({url:"/accounts/degree_plan_view",method:"PUT",data:{mode:"NAME",code:a.code,name:$(this).val()},success:function(a){console.log("Degree plan name updated")}})}}(c));var k=$('<td class="col-2 plan-td"/>').append(h);c.editIcon=$('<div class="text-area-icon"><i class="fas fa-edit"></i></div>');h.click(function(a){return function(){a.editIcon.hide()}}(c));h.blur(function(a){return function(){a.editIcon.show()}}(c));
k.append(c.editIcon);f.append(k);f.append('<td class="col-1 plan-td text-center"><small>'+a[b][0]+"</small></td>");f.append('<td class="col-2 plan-td text-center"><p>'+stringifyDegreeCodes(e.degrees)+"</p></td>");f.append('<td class="col-4 plan-td text-center">'+stringifyMMS(e.trackedMMS)+"</td>");f.append('<td class="col-1 plan-td text-center">Semester '+e.startSem+" "+e.startYear+"</td>");f.append('<td class="col-1 plan-td text-center">'+e.created+"</td>");g.append(createLoadBtn(c.code,e.startYear,
e.startSem));g.append(createDeleteBtn(c.code));f.append(g);d.append(f)}}}})}$.when(mapMMSCodeToTitle("majors",majorDict),mapMMSCodeToTitle("minors",minorDict),mapMMSCodeToTitle("specs",specDict)).done(function(){createSavedPlansTable()});
