{% extends 'staff_pages/staff_base.html' %}
{% block content %}
     <div style="margin-top: 15px; flex-wrap: nowrap" >
    <div style="width: 100%; text-align: center">
<table class="table">
    <tr>
        <td>
        <input type="text" id = "search" name="MMS name" required placeholder="Search MMS"
               autocomplete="off" data-toggle="popover" style="width:30%">
        <button onclick="showMajors()" class="btn btn-primary btn-lg">Show MMS</button>
        </td>
        </tr>
    <tr>
        <td>
        <label>Academic year: </label>
              <select id="year" class="btn-group">
    <option value="2014" selected="selected">2014</option>
    <option value="2015">2015</option>
    <option value="2016">2016</option>
    <option value="2017">2017</option>
    <option value="2018">2018</option>
    <option value="2019">2019</option>
    <option value="2020">2020</option>
</select>
        </td>
    </tr>
    </table>
        <div>&nbsp</div>
        <div class="table-responsive">
            <table class="table" style="width: 50%; margin: auto">
                    <tbody id="Table">
                    </tbody>
                </table>
        </div>
    </div>
</div>
    <script>
        let level="undergraduate";
        let description="";
            function showMajors() {
        let majors = document.getElementById("search").value;
        //let level = document.getElementById("level").value;
        //let year= document.getElementById("selectedYear").value;
        let tableData = "<tr>";
        let tempRequirement = "";
        majorCodes = [];
        majorVersions=[];
        const majorDescription = [];
        const majorRequirements = [];
        const majorTitle = [];
        $.ajax({
            url: 'search/majors',
            data: {"query": majors, "level": level},
            success: function (data) {
                for (i in data.responses) {
                    majorVersions.push(JSON.stringify(data.responses[i].versions));
                    description=JSON.stringify(data.responses[i].versions["2019"].description);
                    description=str_substr("\"",".",description);
                    majorCodes.push(data.responses[i].code);
                    majorDescription.push(description+"......");
                    tempRequirement = JSON.stringify(data.responses[i].versions["2019"].requirements.x_from_here[0]);
                    tempRequirement =replaceString(tempRequirement);
                    tempRequirement="title"+str_substr("title","title",tempRequirement)+"...";
                    majorRequirements.push(tempRequirement);
                    majorTitle.push(JSON.stringify(data.responses[i].versions["2019"].title).replace(/\"/g,""));
                }
                if (majorCodes.length == 0) {
                    tableData += "<th>" + "No such major" + "</th>" + "</tr>";
                } else {
                    for (var i = 0; i < majorCodes.length + 1; i++) {
                        for (var j = 0; j < 5; j++) {
                            if (i == 0) {
                                if (j == 0) {
                                    tableData += "<th>" + "Major Code" + "</th>";
                                } else if (j == 1) {
                                    tableData += "<th>" + "Major Title" + "</th>";
                                } else if (j == 2) {
                                    tableData += "<th>" + "Major Requrirement" + "</th>";
                                } else if (j == 3) {
                                    tableData += "<th>" + "Major Description" + "</th>";
                                }
                                else if(j==4){
                                    tableData += "<th>" + "Edit button" + "</th>";
                                }
                            } else {
                                if (j == 0) {
                                    tableData += "<td>" + majorCodes[i - 1] + "</td>";
                                } else if (j == 3) {
                                    tableData += "<td>" + majorDescription[i - 1] + "</td>";
                                } else if (j == 2) {
                                    tableData += "<td>" + majorRequirements[i - 1] + "</td>";
                                } else if (j == 1) {
                                    tableData += "<td>" + majorTitle[i - 1] + "</td>";
                                }
                                else if (j==4){
                                    tableData += "<td>" + "<input type=\"button\" class=\"btn btn-primary btn-lg\" id=\"btn\" value=\"edit\" onClick=\"saveData('major','"+(i-1)+"');location.href='majorEdit'\">" + "</td>";
                                }
                            }
                        }
                        tableData += "</tr>" + "<tr>";
                    }
                }
                $("#Table").html(tableData);
            }
        });
    }

    function showMinors() {

        let minors = document.getElementById("search").value;
        //let level = document.getElementById("level").value;
        //let year= document.getElementById("selectedYear").value;
        let tableData = "<tr>";
        let tempRequirement = "";
        minorCodes = [];
        minorVersions=[];
        const minorDescription = [];
        const minorRequirements = [];
        const minorTitle = [];
        $.ajax({
            url: 'search/minors',
            data: {"query": minors, "level": level},
            success: function (data) {
                let i;
                for (i in data.responses) {

                    minorVersions.push(JSON.stringify(data.responses[i].versions));
                    minorCodes.push(data.responses[i].code);
                    description=JSON.stringify(data.responses[i].versions["2019"].description);
                    description=str_substr("\"",".",description);
                    minorDescription.push(description+"......");
                    tempRequirement = JSON.stringify(data.responses[i].versions["2019"].requirements);
                    tempRequirement = replaceString(tempRequirement);
                    tempRequirement="title"+str_substr("title","title",tempRequirement)+"...";
                    minorRequirements.push(tempRequirement);
                    minorTitle.push(JSON.stringify(data.responses[i].versions["2019"].title).replace(/\"/g,""));
                }
                if (minorCodes.length == 0) {
                    tableData += "<th>" + "No such minor" + "</th>" + "</tr>";
                } else {
                    for (i = 0; i < minorCodes.length + 1; i++) {
                        for (let j = 0; j < 5; j++) {
                            if (i == 0) {
                                if (j == 0) {
                                    tableData += "<th>" + "minor Code" + "</th>";
                                } else if (j == 1) {
                                    tableData += "<th>" + "minor Title" + "</th>";
                                } else if (j == 2) {
                                    tableData += "<th>" + "minor Requrirement" + "</th>";
                                } else if (j == 3) {
                                    tableData += "<th>" + "minor Description" + "</th>";
                                }
                                else if (j == 4) {
                                    tableData += "<th>" + "Edit button" + "</th>";
                                }
                            } else {
                                if (j == 0) {
                                    tableData += "<td>" + minorCodes[i - 1] + "</td>";
                                } else if (j == 3) {
                                    tableData += "<td>" + minorDescription[i - 1] + "</td>";
                                } else if (j == 2) {
                                    tableData += "<td>" + minorRequirements[i - 1] + "</td>";
                                } else if (j == 1) {
                                    tableData += "<td>" + minorTitle[i - 1] + "</td>";
                                }
                                 else if (j==4){
                                    tableData += "<td>" + "<input type=\"button\" class=\"btn btn-primary btn-lg\" id=\"btn\" value=\"edit\" onClick=\"saveData('minor','"+(i-1)+"');location.href='majorEdit'\">" + "</td>";
                                }
                            }
                        }
                        tableData += "</tr>" + "<tr>";
                    }
                }
                $("#Table").html(tableData);
            }
        });
    }

    function showSpecs() {
        let specs = document.getElementById("search").value;
        //let level = document.getElementById("level").value;
        //let year= document.getElementById("selectedYear").value;
        let tableData = "<tr>";
        let tempRequirement = "";
        specCodes = [];
        specVersions=[];
        const specDescription = [];
        const specRequirements = [];
        const specsTitle = [];
        $.ajax({
            url: 'search/specs',
            data: {"query": specs, "level": level},
            success: function (data) {
                for (i in data.responses) {
                    specVersions.push(data.responses[i].version);
                    specCodes.push(data.responses[i].code);
                    description=JSON.stringify(data.responses[i].versions["2016"].description);
                    description=str_substr("\"",".",description);
                    specDescription.push(description+".......");
                    tempRequirement = JSON.stringify(data.responses[i].versions["2016"].requirements);
                    tempRequirement = replaceString(tempRequirement);
                    tempRequirement="title"+str_substr("title","title",tempRequirement)+"...";
                    specRequirements.push(tempRequirement);
                    specsTitle.push(JSON.stringify(data.responses[i].versions["2016"].title).replace(/\"/g,""));
                }
                if (specCodes.length == 0) {
                    tableData += "<th>" + "No such spec" + "</th>" + "</tr>";
                } else {
                    for (var i = 0; i < specCodes.length + 1; i++) {
                        for (var j = 0; j < 5; j++) {
                            if (i == 0) {
                                if (j == 0) {
                                    tableData += "<th>" + "spec Code" + "</th>";
                                } else if (j == 1) {
                                    tableData += "<th>" + "spec Title" + "</th>";
                                } else if (j == 2) {
                                    tableData += "<th>" + "spec Requrirement" + "</th>";
                                } else if (j == 3) {
                                    tableData += "<th>" + "spec Description" + "</th>";
                                }
                                else if (j == 4) {
                                    tableData += "<th>" + "Edit button" + "</th>";
                                }
                            } else {
                                if (j == 0) {
                                    tableData += "<td>" + specCodes[i - 1] + "</td>";
                                } else if (j == 3) {
                                    tableData += "<td>" + specDescription[i - 1] + "</td>";
                                } else if (j == 2) {
                                    tableData += "<td>" + specRequirements[i - 1] + "</td>";
                                } else if (j == 1) {
                                    tableData += "<td>" + specsTitle[i - 1] + "</td>";
                                }
                                 else if (j==4){
                                    tableData += "<td>" + "<input type=\"button\" class=\"btn btn-primary btn-lg\" id=\"btn\" value=\"edit\" onClick=\"saveData('spec','"+(i-1)+"');location.href='majorEdit'\">" + "</td>";
                                }
                            }
                        }
                        tableData += "</tr>" + "<tr>";
                    }
                }
                $("#Table").html(tableData);
            }
        });
    }
    </script>
{#<h1>MMS</h1>#}

{% endblock %}
